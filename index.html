<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>IRONLOG - Workout Recorder</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0f172a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="apple-touch-icon" href="icon-192.png">
  <meta name="description" content="Track your workouts and fitness gains">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    body { margin: 0; font-family: 'DM Sans', sans-serif; }
    .carousel-container { scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
    .carousel-container::-webkit-scrollbar { display: none; }
    .carousel-container > div { scroll-snap-align: start; }
    .glow-amber { box-shadow: 0 0 40px rgba(251, 191, 36, 0.15); }
    .glow-card { box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3); }
    .glow-card-light { box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1); }
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .animate-slideUp { animation: slideUp 0.3s ease-out; }
    input[type="number"]::-webkit-inner-spin-button, input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    input[type="number"] { -moz-appearance: textfield; }
  </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useRef } = React;

const Icon = ({ name, className }) => {
  const iconRef = useRef(null);
  useEffect(() => {
    if (iconRef.current) {
      iconRef.current.innerHTML = '';
      iconRef.current.appendChild(lucide.createElement(lucide.icons[name]));
    }
  }, [name]);
  return <span ref={iconRef} className={className} style={{ display: 'inline-flex', alignItems: 'center', justifyContent: 'center' }} />;
};

const generateId = () => Math.random().toString(36).substr(2, 9);
const MONTHS = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
const PRESET_COLORS = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E9', '#E74C3C', '#3498DB', '#2ECC71', '#F39C12', '#9B59B6', '#1ABC9C', '#E91E63', '#00BCD4', '#FF9800', '#8BC34A', '#922B21', '#1A5276', '#145A32', '#7D6608', '#4A235A', '#0E6655', '#880E4F', '#006064', '#E65100', '#33691E', '#5D6D7E', '#839192', '#2C3E50', '#7F8C8D', '#34495E'];
const getDaysInMonth = (year, month) => new Date(year, month + 1, 0).getDate();
const getFirstDayOfMonth = (year, month) => new Date(year, month, 1).getDay();
const formatDuration = (minutes) => {
  if (minutes < 60) return minutes + 'm';
  const hrs = Math.floor(minutes / 60);
  const mins = minutes % 60;
  return mins > 0 ? hrs + 'h ' + mins + 'm' : hrs + 'h';
};
const STORAGE_KEYS = { workoutTypes: 'workout-recorder-types', workoutLogs: 'workout-recorder-logs', darkMode: 'workout-recorder-darkmode' };

function WorkoutRecorder() {
  const [activeTab, setActiveTab] = useState('calendar');
  const [workoutTypes, setWorkoutTypes] = useState([]);
  const [workoutLogs, setWorkoutLogs] = useState({});
  const [selectedYear, setSelectedYear] = useState(new Date().getFullYear());
  const [currentMonthIndex, setCurrentMonthIndex] = useState(new Date().getMonth());
  const [selectedDay, setSelectedDay] = useState(null);
  const [showAddWorkout, setShowAddWorkout] = useState(false);
  const [newTypeName, setNewTypeName] = useState('');
  const [newTypeColor, setNewTypeColor] = useState(PRESET_COLORS[0]);
  const [editingType, setEditingType] = useState(null);
  const [selectedWorkoutType, setSelectedWorkoutType] = useState('');
  const [workoutHours, setWorkoutHours] = useState(0);
  const [workoutMinutes, setWorkoutMinutes] = useState(0);
  const [darkMode, setDarkMode] = useState(true);
  const carouselRef = useRef(null);

  useEffect(() => {
    try {
      const dm = localStorage.getItem(STORAGE_KEYS.darkMode);
      if (dm !== null) setDarkMode(JSON.parse(dm));
      const st = localStorage.getItem(STORAGE_KEYS.workoutTypes);
      if (st) setWorkoutTypes(JSON.parse(st));
      else setWorkoutTypes([
        { id: generateId(), name: 'Running', color: '#FF6B6B' },
        { id: generateId(), name: 'Weight Training', color: '#4ECDC4' },
        { id: generateId(), name: 'Yoga', color: '#DDA0DD' },
        { id: generateId(), name: 'Cycling', color: '#45B7D1' },
        { id: generateId(), name: 'Swimming', color: '#96CEB4' }
      ]);
      const sl = localStorage.getItem(STORAGE_KEYS.workoutLogs);
      if (sl) setWorkoutLogs(JSON.parse(sl));
    } catch (e) { console.error(e); }
  }, []);

  useEffect(() => { if (workoutTypes.length > 0) localStorage.setItem(STORAGE_KEYS.workoutTypes, JSON.stringify(workoutTypes)); }, [workoutTypes]);
  useEffect(() => { localStorage.setItem(STORAGE_KEYS.workoutLogs, JSON.stringify(workoutLogs)); }, [workoutLogs]);
  useEffect(() => { localStorage.setItem(STORAGE_KEYS.darkMode, JSON.stringify(darkMode)); }, [darkMode]);
  useEffect(() => { if (carouselRef.current) carouselRef.current.scrollTo({ left: currentMonthIndex * carouselRef.current.offsetWidth, behavior: 'auto' }); }, []);

  const scrollToMonth = (i) => { if (carouselRef.current) carouselRef.current.scrollTo({ left: i * carouselRef.current.offsetWidth, behavior: 'smooth' }); setCurrentMonthIndex(i); };
  const getDateKey = (y, m, d) => y + '-' + String(m + 1).padStart(2, '0') + '-' + String(d).padStart(2, '0');
  
  const addWorkoutType = () => {
    if (!newTypeName.trim()) return;
    if (editingType) { setWorkoutTypes(t => t.map(x => x.id === editingType.id ? { ...x, name: newTypeName, color: newTypeColor } : x)); setEditingType(null); }
    else setWorkoutTypes(t => [...t, { id: generateId(), name: newTypeName, color: newTypeColor }]);
    setNewTypeName(''); setNewTypeColor(PRESET_COLORS[Math.floor(Math.random() * PRESET_COLORS.length)]);
  };
  
  const deleteWorkoutType = (id) => setWorkoutTypes(t => t.filter(x => x.id !== id));
  const startEditType = (t) => { setEditingType(t); setNewTypeName(t.name); setNewTypeColor(t.color); };
  
  const addWorkoutLog = () => {
    if (!selectedWorkoutType || !selectedDay) return;
    const total = (workoutHours * 60) + workoutMinutes;
    if (total === 0) return;
    const dk = getDateKey(selectedYear, currentMonthIndex, selectedDay);
    setWorkoutLogs(l => ({ ...l, [dk]: [...(l[dk] || []), { id: generateId(), typeId: selectedWorkoutType, duration: total, timestamp: Date.now() }] }));
    setShowAddWorkout(false); setSelectedWorkoutType(''); setWorkoutHours(0); setWorkoutMinutes(0);
  };
  
  const removeWorkoutLog = (dk, lid) => {
    setWorkoutLogs(l => {
      const dl = l[dk]?.filter(x => x.id !== lid) || [];
      if (dl.length === 0) { const { [dk]: _, ...r } = l; return r; }
      return { ...l, [dk]: dl };
    });
  };
  
  const getWorkoutTypeById = (id) => workoutTypes.find(t => t.id === id);
  
  const getMonthStats = (y, m) => {
    const s = { totalMinutes: 0, totalWorkouts: 0, byType: {} };
    for (let d = 1; d <= getDaysInMonth(y, m); d++) {
      (workoutLogs[getDateKey(y, m, d)] || []).forEach(l => {
        s.totalMinutes += l.duration; s.totalWorkouts += 1;
        if (!s.byType[l.typeId]) s.byType[l.typeId] = { minutes: 0, count: 0 };
        s.byType[l.typeId].minutes += l.duration; s.byType[l.typeId].count += 1;
      });
    }
    return s;
  };
  
  const getYearStats = (y) => {
    const s = { totalMinutes: 0, totalWorkouts: 0, byType: {}, byMonth: [] };
    for (let m = 0; m < 12; m++) {
      const ms = getMonthStats(y, m);
      s.totalMinutes += ms.totalMinutes; s.totalWorkouts += ms.totalWorkouts; s.byMonth.push(ms);
      Object.entries(ms.byType).forEach(([tid, d]) => {
        if (!s.byType[tid]) s.byType[tid] = { minutes: 0, count: 0 };
        s.byType[tid].minutes += d.minutes; s.byType[tid].count += d.count;
      });
    }
    return s;
  };
  
  const getPersonalRecords = () => {
    const r = {};
    Object.values(workoutLogs).flat().forEach(l => {
      if (!r[l.typeId] || l.duration > r[l.typeId]) r[l.typeId] = l.duration;
    });
    return r;
  };

  const cms = getMonthStats(selectedYear, currentMonthIndex);
  const ys = getYearStats(selectedYear);
  const pys = getYearStats(selectedYear - 1);
  const mwd = ys.byMonth.filter(m => m.totalWorkouts > 0).length;
  const avgDiv = Math.max(mwd, 1);
  const pr = getPersonalRecords();

  const th = {
    bg: darkMode ? 'bg-slate-900' : 'bg-gray-100',
    text: darkMode ? 'text-white' : 'text-gray-900',
    card: darkMode ? 'bg-slate-800 glow-card' : 'bg-white glow-card-light',
    cardInner: darkMode ? 'bg-slate-700/50' : 'bg-gray-100',
    input: darkMode ? 'bg-slate-700 border-slate-600' : 'bg-gray-100 border-gray-300',
    nav: darkMode ? 'bg-slate-900/95 border-slate-800' : 'bg-white/95 border-gray-200',
    btn: darkMode ? 'bg-slate-800 hover:bg-slate-700' : 'bg-gray-200 hover:bg-gray-300',
    btnTxt: darkMode ? 'text-slate-400 hover:text-white' : 'text-gray-600 hover:text-gray-900',
    muted: darkMode ? 'text-slate-400' : 'text-gray-500',
    faint: darkMode ? 'text-slate-500' : 'text-gray-400',
    border: darkMode ? 'border-slate-700' : 'border-gray-300',
    barBg: darkMode ? 'bg-slate-700' : 'bg-gray-200',
    barFill: darkMode ? 'bg-slate-600' : 'bg-gray-400',
  };

  const CalendarDay = ({ day, month, year }) => {
    const dateKey = getDateKey(year, month, day);
    const dayLogs = workoutLogs[dateKey] || [];
    const hasWorkouts = dayLogs.length > 0;
    const isToday = new Date().getDate() === day && new Date().getMonth() === month && new Date().getFullYear() === year;
    const isSelected = selectedDay === day && currentMonthIndex === month;
    const uniqueColors = [...new Set(dayLogs.map(l => getWorkoutTypeById(l.typeId)?.color).filter(Boolean))];
    return (
      <button onClick={() => { setSelectedDay(day); setCurrentMonthIndex(month); }}
        className={`relative aspect-square rounded-xl flex flex-col items-center justify-center transition-all duration-300 border
          ${isSelected ? 'ring-2 ring-amber-400 ring-offset-2 scale-105 ' + (darkMode ? 'ring-offset-slate-900' : 'ring-offset-gray-100') : ''}
          ${hasWorkouts ? (darkMode ? 'bg-gradient-to-br from-slate-700 to-slate-800 shadow-lg' : 'bg-white shadow border-gray-200') : (darkMode ? 'bg-slate-800/50 hover:bg-slate-700/50 border-slate-700/50' : 'bg-white hover:bg-gray-50 border-gray-200')}
          ${isToday ? 'border-2 border-amber-500/50' : ''}`}>
        <span className={`text-sm font-medium ${isToday ? 'text-amber-500' : hasWorkouts ? (darkMode ? 'text-white' : 'text-gray-900') : th.faint}`}>{day}</span>
        {hasWorkouts && <div className="flex gap-0.5 mt-1">{uniqueColors.slice(0, 3).map((c, i) => <div key={i} className="w-1.5 h-1.5 rounded-full" style={{ backgroundColor: c }} />)}{uniqueColors.length > 3 && <span className={`text-[8px] ${th.faint}`}>+{uniqueColors.length - 3}</span>}</div>}
      </button>
    );
  };

  const MonthCalendar = ({ month, year }) => {
    const days = [];
    for (let i = 0; i < getFirstDayOfMonth(year, month); i++) days.push(<div key={`e-${i}`} />);
    for (let d = 1; d <= getDaysInMonth(year, month); d++) days.push(<CalendarDay key={d} day={d} month={month} year={year} />);
    return (
      <div className="min-w-full flex-shrink-0 px-2">
        <div className="grid grid-cols-7 gap-1 mb-2">{['S','M','T','W','T','F','S'].map((d,i) => <div key={i} className={`text-center text-xs font-medium ${th.faint} py-2`}>{d}</div>)}</div>
        <div className="grid grid-cols-7 gap-1">{days}</div>
      </div>
    );
  };

  const StatsBar = ({ label, value, maxValue, color }) => (
    <div className="space-y-1">
      <div className="flex justify-between text-sm"><span className={darkMode ? 'text-slate-300' : 'text-gray-700'}>{label}</span><span className={th.muted}>{formatDuration(value)}</span></div>
      <div className={`h-2 ${th.barBg} rounded-full overflow-hidden`}><div className="h-full rounded-full" style={{ width: `${maxValue > 0 ? (value / maxValue) * 100 : 0}%`, backgroundColor: color }} /></div>
    </div>
  );

  return (
    <div className={`min-h-screen ${th.bg} ${th.text}`} style={{ fontFamily: "'DM Sans', sans-serif" }}>
      <header className={`sticky top-0 z-40 ${th.nav} backdrop-blur-sm border-b`}>
        <div className="max-w-2xl mx-auto px-4 py-4">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center glow-amber"><Icon name="Dumbbell" className="w-5 h-5 text-slate-900" /></div>
              <div><h1 className="text-lg font-bold tracking-tight">IRONLOG</h1><p className={`text-xs ${th.faint}`} style={{ fontFamily: "'Space Mono', monospace" }}>Track your gains</p></div>
            </div>
            <div className="flex items-center gap-2">
              <button onClick={() => setDarkMode(!darkMode)} className={`p-2 rounded-lg ${th.btn}`}><Icon name={darkMode ? 'Sun' : 'Moon'} className="w-5 h-5" /></button>
              <select value={selectedYear} onChange={(e) => setSelectedYear(Number(e.target.value))} className={`${th.btn} ${th.border} border rounded-lg px-3 py-2 text-sm font-medium focus:outline-none focus:ring-2 focus:ring-amber-500`}>
                {Array.from({ length: 10 }, (_, i) => new Date().getFullYear() - 5 + i).map(y => <option key={y} value={y}>{y}</option>)}
              </select>
            </div>
          </div>
        </div>
      </header>

      <nav className={`sticky top-[73px] z-30 ${th.nav} backdrop-blur-sm border-b`}>
        <div className="max-w-2xl mx-auto px-4">
          <div className="flex gap-1 py-2">
            {[{ id: 'calendar', icon: 'Calendar', label: 'Calendar' }, { id: 'stats', icon: 'BarChart3', label: 'Stats' }, { id: 'workouts', icon: 'Dumbbell', label: 'Workouts' }].map(tab => (
              <button key={tab.id} onClick={() => setActiveTab(tab.id)} className={`flex-1 flex items-center justify-center gap-2 py-3 rounded-lg text-sm font-medium transition-all ${activeTab === tab.id ? 'bg-amber-500 text-slate-900' : th.btnTxt + ' ' + th.btn}`}>
                <Icon name={tab.icon} className="w-4 h-4" />{tab.label}
              </button>
            ))}
          </div>
        </div>
      </nav>

      <main className="max-w-2xl mx-auto px-4 py-6">
        {activeTab === 'calendar' && (
          <div className="space-y-6 animate-slideUp">
            <div className="flex items-center justify-between">
              <button onClick={() => scrollToMonth(Math.max(0, currentMonthIndex - 1))} className={`p-2 rounded-lg ${th.btn}`}><Icon name="ChevronLeft" className="w-5 h-5" /></button>
              <h2 className="text-xl font-bold">{MONTHS[currentMonthIndex]}</h2>
              <button onClick={() => scrollToMonth(Math.min(11, currentMonthIndex + 1))} className={`p-2 rounded-lg ${th.btn}`}><Icon name="ChevronRight" className="w-5 h-5" /></button>
            </div>
            <div className="flex justify-center gap-1">{MONTHS.map((_, i) => <button key={i} onClick={() => scrollToMonth(i)} className={`w-2 h-2 rounded-full transition-all ${i === currentMonthIndex ? 'bg-amber-500 w-6' : th.barBg}`} />)}</div>
            <div ref={carouselRef} className="carousel-container flex overflow-x-auto" onScroll={(e) => { const ni = Math.round(e.target.scrollLeft / e.target.offsetWidth); if (ni !== currentMonthIndex) setCurrentMonthIndex(ni); }}>
              {MONTHS.map((_, i) => <MonthCalendar key={i} month={i} year={selectedYear} />)}
            </div>
            {selectedDay && (
              <div className={`${th.card} rounded-2xl p-5 animate-slideUp`}>
                <div className="flex items-center justify-between mb-4">
                  <h3 className="font-semibold">{MONTHS[currentMonthIndex]} {selectedDay}, {selectedYear}</h3>
                  <button onClick={() => setShowAddWorkout(true)} className="flex items-center gap-2 px-4 py-2 bg-amber-500 hover:bg-amber-400 text-slate-900 rounded-lg font-medium text-sm"><Icon name="Plus" className="w-4 h-4" />Add Workout</button>
                </div>
                {(() => {
                  const dk = getDateKey(selectedYear, currentMonthIndex, selectedDay);
                  const dl = workoutLogs[dk] || [];
                  if (dl.length === 0) return <p className={`${th.faint} text-center py-8`}>No workouts recorded. Click "Add Workout" to get started!</p>;
                  return (
                    <div className="space-y-2">
                      {dl.map(log => {
                        const type = getWorkoutTypeById(log.typeId);
                        if (!type) return null;
                        return (
                          <div key={log.id} className={`flex items-center justify-between ${th.cardInner} rounded-xl p-3`}>
                            <div className="flex items-center gap-3"><div className="w-3 h-3 rounded-full" style={{ backgroundColor: type.color }} /><span className="font-medium">{type.name}</span></div>
                            <div className="flex items-center gap-3">
                              <span className={`${th.muted} text-sm flex items-center gap-1`}><Icon name="Clock" className="w-3 h-3" />{formatDuration(log.duration)}</span>
                              <button onClick={() => removeWorkoutLog(dk, log.id)} className="p-1.5 rounded-lg hover:bg-red-500/20 text-red-400"><Icon name="Trash2" className="w-4 h-4" /></button>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  );
                })()}
              </div>
            )}
          </div>
        )}

        {activeTab === 'stats' && (
          <div className="space-y-6 animate-slideUp">
            <div className="grid grid-cols-2 gap-3">
              <div className={`bg-gradient-to-br ${darkMode ? 'from-amber-500/20 to-orange-500/20 border-amber-500/20' : 'from-amber-100 to-orange-100 border-amber-200'} rounded-2xl p-4 border`}>
                <div className="flex items-center gap-2 text-amber-500 mb-2"><Icon name="Flame" className="w-4 h-4" /><span className="text-xs font-medium uppercase tracking-wider">This Month</span></div>
                <p className="text-2xl font-bold">{formatDuration(cms.totalMinutes)}</p>
                <p className={`text-sm ${th.muted}`}>{cms.totalWorkouts} workouts</p>
              </div>
              <div className={`bg-gradient-to-br ${darkMode ? 'from-emerald-500/20 to-teal-500/20 border-emerald-500/20' : 'from-emerald-100 to-teal-100 border-emerald-200'} rounded-2xl p-4 border`}>
                <div className="flex items-center gap-2 text-emerald-500 mb-2"><Icon name="TrendingUp" className="w-4 h-4" /><span className="text-xs font-medium uppercase tracking-wider">This Year</span></div>
                <p className="text-2xl font-bold">{formatDuration(ys.totalMinutes)}</p>
                <p className={`text-sm ${th.muted}`}>{ys.totalWorkouts} workouts</p>
              </div>
              <div className={`bg-gradient-to-br ${darkMode ? 'from-purple-500/20 to-pink-500/20 border-purple-500/20' : 'from-purple-100 to-pink-100 border-purple-200'} rounded-2xl p-4 border`}>
                <div className="flex items-center gap-2 text-purple-500 mb-2"><Icon name="Award" className="w-4 h-4" /><span className="text-xs font-medium uppercase tracking-wider">Avg/Month</span></div>
                <p className="text-2xl font-bold">{formatDuration(Math.round(ys.totalMinutes / avgDiv))}</p>
                <p className={`text-sm ${th.muted}`}>{mwd > 0 ? (ys.totalWorkouts / avgDiv).toFixed(1) + ' workouts/mo' : 'No data yet'}</p>
              </div>
              <div className={`bg-gradient-to-br ${darkMode ? 'from-blue-500/20 to-cyan-500/20 border-blue-500/20' : 'from-blue-100 to-cyan-100 border-blue-200'} rounded-2xl p-4 border`}>
                <div className="flex items-center gap-2 text-blue-500 mb-2"><Icon name="Target" className="w-4 h-4" /><span className="text-xs font-medium uppercase tracking-wider">vs Last Year</span></div>
                <p className="text-2xl font-bold">{pys.totalMinutes > 0 ? (ys.totalMinutes >= pys.totalMinutes ? '+' : '') + Math.round(((ys.totalMinutes - pys.totalMinutes) / pys.totalMinutes) * 100) + '%' : '‚Äî'}</p>
                <p className={`text-sm ${th.muted}`}>{formatDuration(pys.totalMinutes)} last year</p>
              </div>
            </div>

            <div className={`${th.card} rounded-2xl p-5`}>
              <h3 className="font-semibold mb-4">Monthly Activity</h3>
              <div className="h-40 flex gap-1">
                {ys.byMonth.map((m, i) => {
                  const max = Math.max(...ys.byMonth.map(x => x.totalMinutes), 1);
                  const h = m.totalMinutes > 0 ? Math.max((m.totalMinutes / max) * 100, 10) : 0;
                  const isCur = i === currentMonthIndex;
                  return (
                    <div key={i} className="flex-1 flex flex-col items-center">
                      <div className="flex-1 w-full flex flex-col justify-end items-center pb-1">
                        {m.totalMinutes > 0 ? <div className={`w-4 sm:w-6 rounded-t-md ${isCur ? 'bg-amber-500' : th.barFill}`} style={{ height: h + '%' }} title={MONTHS[i] + ': ' + formatDuration(m.totalMinutes)} /> : <div className={`w-4 sm:w-6 h-1 rounded-full ${th.barBg}`} />}
                      </div>
                      <span className={`text-[10px] ${isCur ? 'text-amber-500' : th.faint}`}>{MONTHS[i][0]}</span>
                    </div>
                  );
                })}
              </div>
            </div>

            <div className={`${th.card} rounded-2xl p-5`}>
              <h3 className="font-semibold mb-4">Workout Types - {MONTHS[currentMonthIndex]}</h3>
              {Object.keys(cms.byType).length === 0 ? <p className={`${th.faint} text-center py-4`}>No workouts this month</p> : (
                <div className="space-y-3">
                  {Object.entries(cms.byType).sort((a, b) => b[1].minutes - a[1].minutes).map(([tid, d]) => {
                    const t = getWorkoutTypeById(tid);
                    if (!t) return null;
                    return <StatsBar key={tid} label={t.name + ' (' + d.count + ')'} value={d.minutes} maxValue={Math.max(...Object.values(cms.byType).map(x => x.minutes))} color={t.color} />;
                  })}
                </div>
              )}
            </div>

            <div className={`${th.card} rounded-2xl p-5`}>
              <h3 className="font-semibold mb-4">Year Comparison</h3>
              <div className="space-y-4">
                <div className="flex items-center gap-4">
                  <span className={`w-16 text-sm ${th.muted}`}>{selectedYear}</span>
                  <div className={`flex-1 h-6 ${th.barBg} rounded-full overflow-hidden`}><div className="h-full bg-gradient-to-r from-amber-500 to-orange-500 rounded-full" style={{ width: Math.min(100, (ys.totalMinutes / Math.max(ys.totalMinutes, pys.totalMinutes, 1)) * 100) + '%' }} /></div>
                  <span className="text-sm font-medium w-20 text-right">{formatDuration(ys.totalMinutes)}</span>
                </div>
                <div className="flex items-center gap-4">
                  <span className={`w-16 text-sm ${th.muted}`}>{selectedYear - 1}</span>
                  <div className={`flex-1 h-6 ${th.barBg} rounded-full overflow-hidden`}><div className={`h-full ${th.barFill} rounded-full`} style={{ width: Math.min(100, (pys.totalMinutes / Math.max(ys.totalMinutes, pys.totalMinutes, 1)) * 100) + '%' }} /></div>
                  <span className="text-sm font-medium w-20 text-right">{formatDuration(pys.totalMinutes)}</span>
                </div>
              </div>
            </div>

            <div className={`${th.card} rounded-2xl p-5`}>
              <h3 className="font-semibold mb-4">Year Total by Type</h3>
              {Object.keys(ys.byType).length === 0 ? <p className={`${th.faint} text-center py-4`}>No workouts recorded this year</p> : (
                <div className="grid grid-cols-2 gap-3">
                  {Object.entries(ys.byType).sort((a, b) => b[1].minutes - a[1].minutes).map(([tid, d]) => {
                    const t = getWorkoutTypeById(tid);
                    if (!t) return null;
                    return (
                      <div key={tid} className={`${th.cardInner} rounded-xl p-3 border-l-4`} style={{ borderLeftColor: t.color }}>
                        <p className="font-medium text-sm truncate">{t.name}</p>
                        <p className="text-lg font-bold" style={{ color: t.color }}>{formatDuration(d.minutes)}</p>
                        <p className={`text-xs ${th.muted}`}>{d.count} sessions</p>
                      </div>
                    );
                  })}
                </div>
              )}
            </div>

            <div className={`${th.card} rounded-2xl p-5`}>
              <h3 className="font-semibold mb-4">üèÜ Personal Records</h3>
              {Object.keys(pr).length === 0 ? <p className={`${th.faint} text-center py-4`}>No workouts recorded yet</p> : (
                <div className="space-y-2">
                  {Object.entries(pr).sort((a, b) => b[1] - a[1]).map(([tid, dur]) => {
                    const t = getWorkoutTypeById(tid);
                    if (!t) return null;
                    return (
                      <div key={tid} className={`flex items-center justify-between ${th.cardInner} rounded-xl p-3`}>
                        <div className="flex items-center gap-3"><div className="w-3 h-3 rounded-full" style={{ backgroundColor: t.color }} /><span className="font-medium">{t.name}</span></div>
                        <span className="text-amber-500 font-bold">{formatDuration(dur)}</span>
                      </div>
                    );
                  })}
                </div>
              )}
            </div>
          </div>
        )}

        {activeTab === 'workouts' && (
          <div className="space-y-6 animate-slideUp">
            <div className={`${th.card} rounded-2xl p-5`}>
              <h3 className="font-semibold mb-4">Create Workout Type</h3>
              <div className="space-y-4">
                <input type="text" value={newTypeName} onChange={(e) => setNewTypeName(e.target.value)} placeholder="Workout name..." className={`w-full ${th.input} border rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-amber-500`} />
                <div>
                  <label className={`text-sm ${th.muted} mb-2 block`}>Select Color</label>
                  <div className="flex flex-wrap gap-2">{PRESET_COLORS.map(c => <button key={c} onClick={() => setNewTypeColor(c)} className={`w-8 h-8 rounded-lg transition-all ${newTypeColor === c ? 'ring-2 ring-amber-500 ring-offset-2 scale-110 ' + (darkMode ? 'ring-offset-slate-800' : 'ring-offset-white') : ''}`} style={{ backgroundColor: c }} />)}</div>
                </div>
                <button onClick={addWorkoutType} disabled={!newTypeName.trim()} className="w-full py-3 bg-amber-500 hover:bg-amber-400 disabled:bg-gray-400 disabled:cursor-not-allowed text-slate-900 rounded-xl font-medium flex items-center justify-center gap-2">
                  <Icon name={editingType ? 'Check' : 'Plus'} className="w-4 h-4" />{editingType ? 'Update Workout Type' : 'Add Workout Type'}
                </button>
                {editingType && <button onClick={() => { setEditingType(null); setNewTypeName(''); setNewTypeColor(PRESET_COLORS[0]); }} className={`w-full py-2 ${th.muted} text-sm`}>Cancel Editing</button>}
              </div>
            </div>
            <div className={`${th.card} rounded-2xl p-5`}>
              <h3 className="font-semibold mb-4">Your Workout Types</h3>
              {workoutTypes.length === 0 ? <p className={`${th.faint} text-center py-4`}>No workout types yet. Create one above!</p> : (
                <div className="space-y-2">
                  {workoutTypes.map(t => (
                    <div key={t.id} className={`flex items-center justify-between ${th.cardInner} rounded-xl p-3`}>
                      <div className="flex items-center gap-3"><div className="w-4 h-4 rounded-full" style={{ backgroundColor: t.color }} /><span className="font-medium">{t.name}</span></div>
                      <div className="flex items-center gap-1">
                        <button onClick={() => startEditType(t)} className={`p-2 rounded-lg ${th.btn} ${th.btnTxt}`}><Icon name="Edit3" className="w-4 h-4" /></button>
                        <button onClick={() => deleteWorkoutType(t.id)} className="p-2 rounded-lg hover:bg-red-500/20 text-red-400"><Icon name="Trash2" className="w-4 h-4" /></button>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          </div>
        )}
      </main>

      {showAddWorkout && (
        <div className={`fixed inset-0 z-50 flex items-end sm:items-center justify-center p-4 ${darkMode ? 'bg-black/60' : 'bg-black/40'} backdrop-blur-sm`}>
          <div className={`${th.card} rounded-2xl p-6 w-full max-w-md animate-slideUp`}>
            <div className="flex items-center justify-between mb-6">
              <h3 className="text-lg font-bold">Log Workout</h3>
              <button onClick={() => setShowAddWorkout(false)} className={`p-2 rounded-lg ${th.btn}`}><Icon name="X" className="w-5 h-5" /></button>
            </div>
            <div className="space-y-4">
              <div>
                <label className={`text-sm ${th.muted} mb-2 block`}>Workout Type</label>
                {workoutTypes.length === 0 ? <p className={`${th.faint} text-sm`}>No workout types created. Go to the Workouts tab to create one.</p> : (
                  <div className="grid grid-cols-2 gap-2">
                    {workoutTypes.map(t => (
                      <button key={t.id} onClick={() => setSelectedWorkoutType(t.id)} className={`p-3 rounded-xl border-2 transition-all text-left ${selectedWorkoutType === t.id ? 'border-amber-500 bg-amber-500/10' : th.border}`}>
                        <div className="flex items-center gap-2"><div className="w-3 h-3 rounded-full" style={{ backgroundColor: t.color }} /><span className="text-sm font-medium truncate">{t.name}</span></div>
                      </button>
                    ))}
                  </div>
                )}
              </div>
              <div>
                <label className={`text-sm ${th.muted} mb-3 block`}>Duration</label>
                <div className="flex items-center gap-3">
                  <div className="flex-1">
                    <div className={`flex items-center gap-2 ${th.cardInner} rounded-xl p-2`}>
                      <button onClick={() => setWorkoutHours(h => Math.max(0, h - 1))} className={`w-10 h-10 rounded-lg ${th.btn} flex items-center justify-center text-xl font-bold`}>‚àí</button>
                      <div className="flex-1 text-center">
                        <input type="number" min="0" max="24" value={workoutHours} onChange={(e) => setWorkoutHours(Math.max(0, Math.min(24, parseInt(e.target.value) || 0)))} className={`w-full bg-transparent text-center text-2xl font-bold focus:outline-none ${th.text}`} />
                        <span className={`text-xs ${th.muted}`}>hours</span>
                      </div>
                      <button onClick={() => setWorkoutHours(h => Math.min(24, h + 1))} className={`w-10 h-10 rounded-lg ${th.btn} flex items-center justify-center text-xl font-bold`}>+</button>
                    </div>
                  </div>
                  <span className={`text-2xl font-bold ${th.faint}`}>:</span>
                  <div className="flex-1">
                    <div className={`flex items-center gap-2 ${th.cardInner} rounded-xl p-2`}>
                      <button onClick={() => setWorkoutMinutes(m => Math.max(0, m - 5))} className={`w-10 h-10 rounded-lg ${th.btn} flex items-center justify-center text-xl font-bold`}>‚àí</button>
                      <div className="flex-1 text-center">
                        <input type="number" min="0" max="59" value={workoutMinutes} onChange={(e) => setWorkoutMinutes(Math.max(0, Math.min(59, parseInt(e.target.value) || 0)))} className={`w-full bg-transparent text-center text-2xl font-bold focus:outline-none ${th.text}`} />
                        <span className={`text-xs ${th.muted}`}>minutes</span>
                      </div>
                      <button onClick={() => setWorkoutMinutes(m => Math.min(59, m + 5))} className={`w-10 h-10 rounded-lg ${th.btn} flex items-center justify-center text-xl font-bold`}>+</button>
                    </div>
                  </div>
                </div>
                <div className="flex flex-wrap gap-2 mt-3">
                  {[{l:'30m',h:0,m:30},{l:'1h',h:1,m:0},{l:'1h 30m',h:1,m:30},{l:'2h',h:2,m:0},{l:'3h',h:3,m:0},{l:'4h',h:4,m:0},{l:'6h',h:6,m:0},{l:'8h',h:8,m:0}].map(p => (
                    <button key={p.l} onClick={() => { setWorkoutHours(p.h); setWorkoutMinutes(p.m); }} className={`px-3 py-1.5 rounded-lg text-sm font-medium ${workoutHours === p.h && workoutMinutes === p.m ? 'bg-amber-500 text-slate-900' : th.cardInner + ' ' + th.muted}`}>{p.l}</button>
                  ))}
                </div>
              </div>
              <button onClick={addWorkoutLog} disabled={!selectedWorkoutType || (workoutHours === 0 && workoutMinutes === 0)} className="w-full py-3 bg-amber-500 hover:bg-amber-400 disabled:bg-gray-400 disabled:cursor-not-allowed text-slate-900 rounded-xl font-medium flex items-center justify-center gap-2">
                <Icon name="Check" className="w-4 h-4" />Save Workout ({formatDuration((workoutHours * 60) + workoutMinutes)})
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

ReactDOM.render(<WorkoutRecorder />, document.getElementById('root'));
</script>
</body>
</html>
